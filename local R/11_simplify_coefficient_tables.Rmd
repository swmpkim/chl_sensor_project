---
title: "Simplified coefficient tables"
author: "Kim Cressman"
date: "2/2/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message = FALSE, warning = FALSE}
library(tidyverse)
library(readxl)
library(patchwork)
files_allRes <- c("AllRes_TankAndISCO", "AllRes_TankOnly")
files_indRes <- c("IndRes_TankAndISCO", "IndRes_TankOnly")
```

# Individual Reserve Models  

## Tank and ISCO  

```{r}
dat <- read_csv(here::here("model_coeffs",
                           paste0(files_indRes[[1]], ".csv")))

dat_cleaner <- dat %>% 
    select(Reserve, model, AICc, R.2, prediction_error = pred_test_error,
           sensor_rfu, fdom_qsu, turb, temp, season,
           everything()) %>% 
    mutate(across(c(AICc, prediction_error), round, 2),
           across(c(R.2, sensor_rfu), round, 3),
           across(c(fdom_qsu, turb, temp), round, 4),
           across(c(X.Intercept.:fdom_qsu.sensor_rfu.turb), 
                  ~case_when(. < 0 ~ "-",
                             . >= 0 ~ "+")))
```

```{r}
write_csv(dat_cleaner, here::here("model_coeffs", 
                                  paste0(files_indRes[[1]], "_clean.csv")),
          na = "")
```

```{r}
ind_ti_r2 <- ggplot(dat_cleaner,
                 aes(x = Reserve,
                     y = R.2,
                     color = model,
                     shape = model)) +
    geom_point(alpha = 0.7, size = 2) +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    scale_color_brewer(palette = "Set1") +
    labs(x = NULL, y = NULL)

ind_ti_error <- ggplot(dat_cleaner,
                 aes(x = Reserve,
                     y = prediction_error,
                     color = model,
                     shape = model)) +
    geom_point(alpha = 0.7, size = 2) +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    scale_color_brewer(palette = "Set1") +
    labs(x = NULL, y = NULL)
```


## Tank Only  

```{r}
dat <- read_csv(here::here("model_coeffs",
                           paste0(files_indRes[[2]], ".csv")))

dat_cleaner <- dat %>% 
    select(Reserve, model, AICc, R.2, prediction_error = pred_test_error,
           sensor_rfu, fdom_qsu, turb, temp, season,
           everything()) %>% 
    mutate(across(c(AICc, prediction_error), round, 2),
           across(c(R.2, sensor_rfu), round, 3),
           across(c(fdom_qsu, turb, temp), round, 4),
           across(c(X.Intercept.:fdom_qsu.sensor_rfu.turb), 
                  ~case_when(. < 0 ~ "-",
                             . >= 0 ~ "+")))
```

```{r}
write_csv(dat_cleaner, here::here("model_coeffs", 
                                  paste0(files_indRes[[2]], "_clean.csv")),
          na = "")
```



```{r}
ind_t_r2 <- ggplot(dat_cleaner,
                 aes(x = Reserve,
                     y = R.2,
                     color = model,
                     shape = model)) +
    geom_point(alpha = 0.7, size = 2) +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    scale_color_brewer(palette = "Set1") +
    labs(x = NULL, y = NULL)

ind_t_error <- ggplot(dat_cleaner,
                 aes(x = Reserve,
                     y = prediction_error,
                     color = model,
                     shape = model)) +
    geom_point(alpha = 0.7, size = 2) +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    scale_color_brewer(palette = "Set1") +
    labs(x = NULL, y = NULL)
```


```{r}
# set up patchwork arrangement
# https://stackoverflow.com/a/60354844

row1 <- ggplot() + annotate(geom = 'text', x=1, y=1, label=expression("R"^"2"), angle = 90) + theme_void() 

row2 <- ggplot() + annotate(geom = 'text', x=1, y=1, label="Median Absolute \nPercent Error", angle = 90) + theme_void() 

col1 <- ggplot() + annotate(geom = 'text', x=1, y=1, label="Tank + ISCO") + theme_void() 

col2 <- ggplot() + annotate(geom = 'text', x=1, y=1, label="Tank Only") + theme_void() 

layoutplot <- "
#cccddd
aeeefff
aeeefff
bggghhh
bggghhh
"

plotlist <- list(a = row1, b = row2, c = col1, d = col2, e= ind_ti_r2, f=ind_t_r2, g=ind_ti_error, h=ind_t_error)

wrap_plots(plotlist, guides = 'collect', design = layoutplot)
```



```{r}
(ind_ti_r2 + ind_t_r2) / (ind_ti_error + ind_t_error) +
  plot_layout(guides = 'collect')
```




# All Reserves  

```{r}
dat <- read_csv(here::here("model_coeffs",
                           paste0(files_allRes[[1]], ".csv")))

dat_cleaner <- dat %>% 
    select(model, AICc, R.2, prediction_error = pred_test_error,
           sensor_rfu, fdom_qsu, turb, temp, season,
           everything()) %>% 
    mutate(across(c(AICc, prediction_error), round, 2),
           across(c(R.2, sensor_rfu), round, 3),
           across(c(fdom_qsu, turb, temp), round, 4),
           across(c(X.Intercept.:fdom_qsu.sensor_rfu.turb), 
                  ~case_when(. < 0 ~ "-",
                             . >= 0 ~ "+")))
```

```{r}
write_csv(dat_cleaner, here::here("model_coeffs", 
                                  paste0(files_allRes[[1]], "_clean.csv")),
          na = "")
```


```{r}
dat <- read_csv(here::here("model_coeffs",
                           paste0(files_allRes[[2]], ".csv")))

dat_cleaner <- dat %>% 
    select(model, AICc, R.2, prediction_error = pred_test_error,
           sensor_rfu, fdom_qsu, turb, temp, season,
           everything()) %>% 
    mutate(across(c(AICc, prediction_error), round, 2),
           across(c(R.2, sensor_rfu), round, 3),
           across(c(fdom_qsu, turb, temp), round, 4),
           across(c(X.Intercept.:fdom_qsu.sensor_rfu.turb), 
                  ~case_when(. < 0 ~ "-",
                             . >= 0 ~ "+")))
```

```{r}
write_csv(dat_cleaner, here::here("model_coeffs", 
                                  paste0(files_allRes[[2]], "_clean.csv")),
          na = "")
```
